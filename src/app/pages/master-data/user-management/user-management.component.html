<app-main-panel>
  <!-- List View -->
  <div class="user-management-container" *ngIf="!isEditView">
    <div class="header-section">
      <h2 class="page-title">Existing Users ({{ totalRecords }})</h2>
    </div>

    <div class="search-section">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input 
          type="text" 
          pInputText 
          placeholder="Search" 
          [(ngModel)]="searchText"
          (input)="onSearch()"
          class="search-input" />
      </span>
    </div>

    <div class="table-container">
      <p-table 
        [value]="filteredUsers" 
        [paginator]="false"
        [rows]="rows"
        [first]="first"
        [loading]="isLoading"
        styleClass="user-table">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="firstName">
              First Name 
              <p-sortIcon field="firstName"></p-sortIcon>
            </th>
            <th pSortableColumn="lastName">
              Last Name 
              <p-sortIcon field="lastName"></p-sortIcon>
            </th>
            <th pSortableColumn="companyName">
              Company Name 
              <p-sortIcon field="companyName"></p-sortIcon>
            </th>
            <th pSortableColumn="emailAddress">
              Email Address 
              <p-sortIcon field="emailAddress"></p-sortIcon>
            </th>
            <th pSortableColumn="assignedCompanies">
              Assigned Companies 
              <p-sortIcon field="assignedCompanies"></p-sortIcon>
            </th>
            <th class="actions-column">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
          <tr>
            <td>{{ user.firstName }}</td>
            <td>{{ user.lastName }}</td>
            <td>{{ user.companyName }}</td>
            <td>{{ user.emailAddress }}</td>
            <td>
              <span>{{ getDisplayCompanies(user) }}</span>
              <span *ngIf="getMoreCount(user) > 0" class="more-link"> + {{ getMoreCount(user) }} More</span>
            </td>
            <td class="actions-column">
              <button 
                pButton 
                label="Edit" 
                class="p-button-rounded edit-button"
                (click)="editUser(user)">
              </button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div class="pagination-section">
      <div class="pagination-info">
        Showing {{ first + 1 }} to {{ (first + rows) > totalRecords ? totalRecords : (first + rows) }} of {{ totalRecords }} entries
      </div>
      <div class="pagination-controls">
        <p-paginator 
          [first]="first" 
          [rows]="rows" 
          [totalRecords]="totalRecords"
          [rowsPerPageOptions]="[10, 25, 50]"
          (onPageChange)="onPageChange($event)"
          styleClass="custom-paginator">
        </p-paginator>
      </div>
    </div>
  </div>

  <!-- Edit View -->
  <app-user-edit 
    *ngIf="isEditView && selectedUser"
    [user]="selectedUser"
    (onCancel)="onCancelEdit()"
    (onSave)="onSaveUser($event)">
  </app-user-edit>
</app-main-panel>
